{"version":3,"sources":["../../../app/controller/groups.js"],"names":["underscore","require","module","exports","HomeController","ctx","private_token","query","token","undefined","error","message","curl","app","baseUrl","dataType","result","gitlab_result","page","pageSize","id","pairs","filter","value","map","join","status","data","slice","size","length","success","Controller"],"mappings":"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","file":"groups.js","sourcesContent":["'use strict';\nconst underscore = require('underscore');\nmodule.exports = app => {\n    class HomeController extends app.Controller {\n        // 获取 所有 grounds\n        * get_all_groups(ctx) {\n            const private_token = ctx.query.token;\n            if (private_token == undefined) {\n                this.error({\n                    message: '401 Unauthorized'\n                }, 401);\n                return;\n            }\n            const result = yield ctx.curl(`${this.app.baseUrl}/groups?private_token=${private_token}`, {\n                dataType: 'json'\n            });\n            this.gitlab_result(result);\n\n        }\n        // 查询某项目组下 项目\n        * search_groups_by_id(ctx) {\n            const private_token = ctx.query.token;\n            if (private_token == undefined) {\n                this.error({\n                    message: '401 Unauthorized'\n                }, 401);\n                return;\n            }\n            var query = ctx.query;\n            const page = query.page || 1;\n            const pageSize = query.pageSize || 20;\n            const id = query.id;\n            if (id == undefined) {\n                this.error({\n                    message: '参数有误'\n                }, 400);\n                return;\n            }\n            query = underscore.pairs(query);\n            query = query.filter(function(value) {\n                return value[0] !== 'page' && value[0] !== 'pageSize' && value[0] !== 'id';\n            }).map(function(value) {\n                return value.join('=');\n            });\n            query = query.join('&');\n            if (query) {\n                query = '&' + query;\n            }\n            const result = yield ctx.curl(`${this.app.baseUrl}/groups/${id}/projects?private_token=${private_token}${query}`, {\n                dataType: 'json'\n            });\n            if (result.status < 300) {\n                var data = result.data;\n                data = {\n                    data: data.slice((page - 1) * pageSize, (page - 1) * pageSize + pageSize),\n                    size: data.length\n                };\n                this.success(data);\n            } else {\n                this.error(result.data, result.status);\n            }\n        }\n        * groups_details_by_id(ctx) {\n            const private_token = ctx.query.token;\n            if (private_token == undefined) {\n                this.error({\n                    message: '401 Unauthorized'\n                }, 401);\n                return;\n            }\n            var query = ctx.query;\n            const id = query.id;\n            if (id == undefined) {\n                this.error({\n                    message: '参数有误'\n                }, 400);\n                return;\n            }\n            const result = yield ctx.curl(`${this.app.baseUrl}/groups/${id}?private_token=${private_token}`, {\n               dataType: 'json'\n            });\n            this.gitlab_result(result);\n        }\n    }\n    return HomeController;\n};\n"]}