{"version":3,"sources":["../../../app/controller/projects.js"],"names":["underscore","require","module","exports","HomeController","ctx","private_token","query","token","undefined","error","message","page","pageSize","pairs","filter","value","map","join","curl","app","baseUrl","dataType","result","status","data","slice","size","length","success","id","isNull","isUndefined","gitlab_result","tag_name","Controller"],"mappings":"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","file":"projects.js","sourcesContent":["'use strict';\nvar underscore = require('underscore');\nmodule.exports = app => {\n    class HomeController extends app.Controller {\n        // 查找项目\n        * get_project(ctx) {\n            const private_token = ctx.query.token;\n            if (private_token == undefined) {\n                this.error({\n                    message: '401 Unauthorized'\n                }, 401);\n                return;\n            }\n            var query = ctx.query;\n            var page = query.page || 1;\n            var pageSize = query.pageSize || 20;\n            if (page <= 0 || pageSize <= 0) {\n                this.error('参数有误', 400);\n            }\n            query = underscore.pairs(query);\n            query = query.filter(function(value) {\n                return value[0] !== 'page' && value[0] !== 'pageSize';\n            }).map(function(value) {\n                return value.join('=');\n            });\n            query = query.join('&');\n            if (query) {\n                query = '&' + query;\n            }\n            const result = yield ctx.curl(`${this.app.baseUrl}/projects?private_token=${private_token}${query}`, {\n                dataType: 'json'\n            });\n            if (result.status < 300) {\n                var data = result.data;\n                data = {\n                    data: data.slice((page - 1) * pageSize, (page - 1) * pageSize + pageSize),\n                    size: data.length\n                };\n                this.success(data);\n            } else {\n                this.error(result.data.message, result.status);\n            }\n        }\n        * get__projects_owned(ctx) {\n            const private_token = ctx.query.token;\n            if (private_token == undefined) {\n                this.error('401 Unauthorized', 401);\n                return;\n            }\n            var query = ctx.query;\n            var page = query.page || 1;\n            var pageSize = query.pageSize || 10;\n            if (page <= 0 || pageSize <= 0) {\n                this.error('参数有误', 400);\n            }\n            query = underscore.pairs(query);\n            query = query.map(function(value) {\n                return value.join('=');\n            });\n            query = query.join('&');\n            if (query) {\n                query = '&' + query;\n            }\n            const result = yield ctx.curl(`${this.app.baseUrl}/projects/owned?private_token=${private_token}${query}`,{\n                dataType: 'json'\n            });\n            if (result.status < 300) {\n                var data = result.data;\n                data = {\n                    data: data.slice((page - 1) * pageSize, (page - 1) * pageSize + pageSize),\n                    size: data.length\n                };\n                this.success(data);\n            } else {\n                this.error(result.data.message, result.status);\n            }\n        }\n        // 查询某项目\n        * search_project(ctx) {\n            const private_token = ctx.query.token;\n            if (private_token == undefined) {\n                this.error('401 Unauthorized', 401);\n                return;\n            }\n            const id = ctx.query.id;\n            if (underscore.isNull(id) || underscore.isUndefined(id)) {\n                this.error('参数有误', 400);\n                return;\n            }\n\n            const result = yield ctx.curl(`${this.app.baseUrl}/projects/${id}?private_token=${private_token}`, {\n                dataType: 'json'\n            });\n            this.gitlab_result(result);\n        }\n        // 查询某项目 tags\n        * search_peoject_tags(ctx) {\n            const private_token = ctx.query.token;\n            if (private_token == undefined) {\n                this.error('401 Unauthorized', 401);\n                return;\n            }\n            const id = ctx.query.id;\n            var tag_name = ctx.query.tag_name || '';\n            if (tag_name) {\n                tag_name = '/' + tag_name;\n            }\n            if (underscore.isNull(id) || underscore.isUndefined(id) || underscore.isNull(tag_name) || underscore.isUndefined(tag_name)) {\n                this.error('参数有误', 400);\n                return;\n            }\n            const result = yield ctx.curl(`${this.app.baseUrl}/projects/${id}/repository/tags${tag_name}?private_token=${private_token}`, {\n                dataType: 'json'\n            });\n            this.gitlab_result(result);\n        }\n\n    }\n    return HomeController;\n};\n"]}