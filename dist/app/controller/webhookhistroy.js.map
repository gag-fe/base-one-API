{"version":3,"sources":["../../../app/controller/webhookhistroy.js"],"names":["WebhookLogField","module","exports","HomeController","ctx","user_id","query","project_name","deploy_status","git_tags","service_ip","undefined","error","whereConfig","app","knex","select","where","result","length","success","Controller"],"mappings":"AAAA;;;;;;;;;;AACA,IAAMA,kBAAkB,CAAC,IAAD,EAAM,cAAN,EAAqB,YAArB,EAAkC,eAAlC,EAAkD,oBAAlD,EAAuE,OAAvE,EAA+E,WAA/E,EAA2F,UAA3F,EAAsG,kBAAtG,EAAyH,iBAAzH,EAA2I,YAA3I,EAAwJ,SAAxJ,EAAkK,cAAlK,EAAiL,SAAjL,EAA2L,WAA3L,CAAxB;;AAEAC,OAAOC,OAAP,GAAiB,eAAO;AAAA,QACdC,cADc;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA,sEAETC,GAFS;AAAA;AAAA;AAAA;AAAA;AAAA;AAGNC,uCAHM,GAGID,IAAIE,KAAJ,CAAUD,OAHd;AAIZ;AACA;;AACME,4CANM,GAMSH,IAAIE,KAAJ,CAAUC,YANnB;AAONC,6CAPM,GAOUJ,IAAIE,KAAJ,CAAUE,aAPpB;AAQNC,wCARM,GAQKL,IAAIE,KAAJ,CAAUG,QARf;AASNC,0CATM,GASON,IAAIE,KAAJ,CAAUI,UATjB;;AAAA,sCAUR,CAACL,OAAD,IAAYA,WAAWM,SAVf;AAAA;AAAA;AAAA;;AAWR,qCAAKC,KAAL,CAAW,MAAX,EAAmB,GAAnB;AAXQ;;AAAA;AAcRC,2CAdQ,GAcM;AACdR,6CAASA;AADK,iCAdN;;AAiBZ,oCAAIE,YAAJ,EAAkB;AACdM,gDAAY,cAAZ,IAA8BN,YAA9B;AACH;AACD,oCAAIC,aAAJ,EAAmB;AACfK,gDAAY,eAAZ,IAA+BL,aAA/B;AACH;AACD,oCAAIC,QAAJ,EAAc;AACVI,gDAAY,UAAZ,IAA0BJ,QAA1B;AACH;AACD,oCAAIC,UAAJ,EAAgB;AACZG,gDAAY,YAAZ,IAA4BH,UAA5B;AACH;AA5BW;AAAA,uCA6BON,IAAIU,GAAJ,CAAQC,IAAR,CAAa,oBAAb,EAAmCC,MAAnC,CAA0ChB,eAA1C,EAA2DiB,KAA3D,CAAiEJ,WAAjE,CA7BP;;AAAA;AA6BRK,sCA7BQ;;AA8BZ;AACA;AACA,oCAAIA,OAAOC,MAAX,EAAmB;AACf,yCAAKC,OAAL,CAAaF,MAAb;AACH,iCAFD,MAEO;AACH,yCAAKE,OAAL,CAAa,EAAb;AACH;;AApCW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,MACSN,IAAIO,UADb;;AAuCpB,WAAOlB,cAAP;AACH,CAxCD","file":"webhookhistroy.js","sourcesContent":["'use strict';\nconst WebhookLogField = ['id','project_name','created_at','deploy_status','deploy_status_text','error','fail_file','git_tags','git_back_ssh_url','service_account','service_ip','ssh_url','success_file','web_url','user_name'];\n\nmodule.exports = app => {\n    class HomeController extends app.Controller {\n        * list(ctx) {\n            const user_id = ctx.query.user_id;\n            // const page = ctx.query.page || 1;\n            // const pageSize = ctx.query.pageSize || 20;\n            const project_name = ctx.query.project_name;\n            const deploy_status = ctx.query.deploy_status;\n            const git_tags = ctx.query.git_tags;\n            const service_ip = ctx.query.service_ip;\n            if (!user_id || user_id == undefined) {\n                this.error('参数有误', 200);\n                return;\n            }\n            let whereConfig = {\n                user_id: user_id\n            };\n            if (project_name) {\n                whereConfig['project_name'] = project_name;\n            }\n            if (deploy_status) {\n                whereConfig['deploy_status'] = deploy_status;\n            }\n            if (git_tags) {\n                whereConfig['git_tags'] = git_tags;\n            }\n            if (service_ip) {\n                whereConfig['service_ip'] = service_ip;\n            }\n            var result = yield ctx.app.knex('webhook_deploy_log').select(WebhookLogField).where(whereConfig);\n            ///const size = result.length;\n            //result = result.splice((page-1) * pageSize , pageSize);\n            if (result.length) {\n                this.success(result);\n            } else {\n                this.success([])\n            }\n        }\n    }\n    return HomeController;\n};\n"]}