{"version":3,"sources":["../../../../app/view/utils/send_sample_request.js"],"names":["define","$","_","initDynamic","off","on","e","preventDefault","$root","parents","group","data","name","version","sendSampleRequest","clearSampleRequest","type","header","find","each","i","element","key","value","optional","defaultValue","param","paramType","not","val","is","next","text","url","pattern","pathToRegexp","matches","exec","length","substr","undefined","replace","encodeURIComponent","fadeTo","html","refreshScrollSpy","t","toLowerCase","JSON","parse","ajaxRequest","headers","toUpperCase","success","displaySuccess","error","displayError","ajax","status","jqXHR","jsonResponse","responseText","stringify","textStatus","message","escape","hide","$urlElement","prop","scrollspy","escapeHtml","str","div","document","createElement","appendChild","createTextNode","innerHTML"],"mappings":"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","file":"send_sample_request.js","sourcesContent":["define([\r\n  'jquery',\r\n  'lodash'\r\n], function($, _) {\r\n\r\n  var initDynamic = function() {\r\n      // Button send\r\n      $(\".sample-request-send\").off(\"click\");\r\n      $(\".sample-request-send\").on(\"click\", function(e) {\r\n          e.preventDefault();\r\n          var $root = $(this).parents(\"article\");\r\n          var group = $root.data(\"group\");\r\n          var name = $root.data(\"name\");\r\n          var version = $root.data(\"version\");\r\n          sendSampleRequest(group, name, version, $(this).data(\"sample-request-type\"));\r\n      });\r\n\r\n      // Button clear\r\n      $(\".sample-request-clear\").off(\"click\");\r\n      $(\".sample-request-clear\").on(\"click\", function(e) {\r\n          e.preventDefault();\r\n          var $root = $(this).parents(\"article\");\r\n          var group = $root.data(\"group\");\r\n          var name = $root.data(\"name\");\r\n          var version = $root.data(\"version\");\r\n          clearSampleRequest(group, name, version);\r\n      });\r\n  }; // initDynamic\r\n\r\n  function sendSampleRequest(group, name, version, type)\r\n  {\r\n      var $root = $('article[data-group=\"' + group + '\"][data-name=\"' + name + '\"][data-version=\"' + version + '\"]');\r\n\r\n      // Optional header\r\n      var header = {};\r\n      $root.find(\".sample-request-header:checked\").each(function(i, element) {\r\n          var group = $(element).data(\"sample-request-header-group-id\");\r\n          $root.find(\"[data-sample-request-header-group=\\\"\" + group + \"\\\"]\").each(function(i, element) {\r\n            var key = $(element).data(\"sample-request-header-name\");\r\n            var value = element.value;\r\n            if ( ! element.optional && element.defaultValue !== '') {\r\n                value = element.defaultValue;\r\n            }\r\n            header[key] = value;\r\n          });\r\n      });\r\n\r\n      // create JSON dictionary of parameters\r\n      var param = {};\r\n      var paramType = {};\r\n      $root.find(\".sample-request-param:checked\").each(function(i, element) {\r\n          var group = $(element).data(\"sample-request-param-group-id\");\r\n          $root.find(\"[data-sample-request-param-group=\\\"\" + group + \"\\\"]\").not(function(){\r\n            return $(this).val() == \"\" && $(this).is(\"[data-sample-request-param-optional='true']\");\r\n          }).each(function(i, element) {\r\n            var key = $(element).data(\"sample-request-param-name\");\r\n            var value = element.value;\r\n            if ( ! element.optional && element.defaultValue !== '') {\r\n                value = element.defaultValue;\r\n            }\r\n            param[key] = value;\r\n            paramType[key] = $(element).next().text();\r\n          });\r\n      });\r\n\r\n      // grab user-inputted URL\r\n      var url = $root.find(\".sample-request-url\").val();\r\n\r\n      // Insert url parameter\r\n      var pattern = pathToRegexp(url, null);\r\n      var matches = pattern.exec(url);\r\n      for (var i = 1; i < matches.length; i++) {\r\n          var key = matches[i].substr(1);\r\n          if (param[key] !== undefined) {\r\n              url = url.replace(matches[i], encodeURIComponent(param[key]));\r\n\r\n              // remove URL parameters from list\r\n              delete param[key];\r\n          }\r\n      } // for\r\n\r\n      $root.find(\".sample-request-response\").fadeTo(250, 1);\r\n      $root.find(\".sample-request-response-json\").html(\"Loading...\");\r\n      refreshScrollSpy();\r\n\r\n      _.each( param, function( val, key ) {\r\n          var t = paramType[ key ].toLowerCase();\r\n          if ( t === 'object' || t === 'array' ) {\r\n              try {\r\n                  param[ key ] = JSON.parse( val );\r\n              } catch (e) {\r\n              }\r\n          }\r\n      });\r\n\r\n      // send AJAX request, catch success or error callback\r\n      var ajaxRequest = {\r\n          url        : url,\r\n          headers    : header,\r\n          data       : param,\r\n          type       : type.toUpperCase(),\r\n          success    : displaySuccess,\r\n          error      : displayError\r\n      };\r\n\r\n      $.ajax(ajaxRequest);\r\n\r\n\r\n      function displaySuccess(data, status, jqXHR) {\r\n          var jsonResponse;\r\n          try {\r\n              jsonResponse = JSON.parse(jqXHR.responseText);\r\n              jsonResponse = JSON.stringify(jsonResponse, null, 4);\r\n          } catch (e) {\r\n              jsonResponse = data;\r\n          }\r\n          $root.find(\".sample-request-response-json\").html(jsonResponse);\r\n          refreshScrollSpy();\r\n      };\r\n\r\n      function displayError(jqXHR, textStatus, error) {\r\n          var message = \"Error \" + jqXHR.status + \": \" + error;\r\n          var jsonResponse;\r\n          try {\r\n              jsonResponse = JSON.parse(jqXHR.responseText);\r\n              jsonResponse = JSON.stringify(jsonResponse, null, 4);\r\n          } catch (e) {\r\n              jsonResponse = escape(jqXHR.responseText);\r\n          }\r\n\r\n          if (jsonResponse)\r\n              message += \"<br>\" + jsonResponse;\r\n\r\n          // flicker on previous error to make clear that there is a new response\r\n          if($root.find(\".sample-request-response\").is(\":visible\"))\r\n              $root.find(\".sample-request-response\").fadeTo(1, 0.1);\r\n\r\n          $root.find(\".sample-request-response\").fadeTo(250, 1);\r\n          $root.find(\".sample-request-response-json\").html(message);\r\n          refreshScrollSpy();\r\n      };\r\n  }\r\n\r\n  function clearSampleRequest(group, name, version)\r\n  {\r\n      var $root = $('article[data-group=\"' + group + '\"][data-name=\"' + name + '\"][data-version=\"' + version + '\"]');\r\n\r\n      // hide sample response\r\n      $root.find(\".sample-request-response-json\").html(\"\");\r\n      $root.find(\".sample-request-response\").hide();\r\n\r\n      // reset value of parameters\r\n      $root.find(\".sample-request-param\").each(function(i, element) {\r\n          element.value = \"\";\r\n      });\r\n\r\n      // restore default URL\r\n      var $urlElement = $root.find(\".sample-request-url\");\r\n      $urlElement.val($urlElement.prop(\"defaultValue\"));\r\n\r\n      refreshScrollSpy();\r\n  }\r\n\r\n  function refreshScrollSpy()\r\n  {\r\n      $('[data-spy=\"scroll\"]').each(function () {\r\n          $(this).scrollspy(\"refresh\");\r\n      });\r\n  }\r\n\r\n  function escapeHtml(str) {\r\n      var div = document.createElement(\"div\");\r\n      div.appendChild(document.createTextNode(str));\r\n      return div.innerHTML;\r\n  }\r\n\r\n  /**\r\n   * Exports.\r\n   */\r\n  return {\r\n      initDynamic: initDynamic\r\n  };\r\n\r\n});\r\n"]}